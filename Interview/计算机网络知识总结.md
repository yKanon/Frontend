### 1. HTTP

#### （1）概况

http是超文本传输协议。定义了客户端和服务器之间交换报文的格式和方式。默认使用80端口。使用TCP作为传输层协议。

HTTP 是一个无状态的协议， http服务器不会保存关于客户的任何信息。

HTTP 有两种链接模式。一种的持续链接，一种非持续链接。

	1. 非持续链接指的是：服务器必须为每一个请求的对象建立和维护一个全新的链接
 	2. 持续链接： TCP链接默认不关闭。可以被多个请求复用。它可以避免每次建立TCP链接三次握手时所花费的时间。HTTP1.1 以后默认采用的是持续链接。同一个域，大多浏览器支持建立6个持续链接。

#### （2）请求报文

* 请求报文

  一个http请求包含：请求行、请求报头、空行和请求数据四个部分组成

  请求方法：GET|POST|HEAD|PUT|DELETE

  > HEAD 和 GET方法类似，但是在返回的响应中，不包含请求对象

  ```js
  GET / HTTP/1.1  /* 请求行： 请求方法|空格|url|空格|协议版本|回车符|换行符（\r\n） */
  Host: www.enjoytoday.cn /* 空行前为请求头，注意每一行的结尾都有回车符和换行符 */
  Connection: keep-alive
  Upgrade-Insecure-Requests: 1
  User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.84 Safari/537.36
  Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
  Referer: http://www.enjoytoday.cn/posts/326
  Accept-Encoding: gzip, deflate, sdch
  Accept-Language: zh-CN,zh;q=0.8
  Cookie: bdshare_firstime=1466032270994; UM_distinctid=15c4ef2ac4e2e4-0d13269271b947-1b2a120b-1fa400-15c4ef2ac4f7b5; un=aGZjYWk=; comment_author=aGZjYWk=; comment_author_email=1710600212@qq.com; comment_author_url=http://www.enjoytoday.cn; c_id=dUhIaTlndmc4MVVYbjRQTGxMRTotMTpFODg3QjgzQjg1NjgxQjQxRUYxNjg2QzJFRkMyQjI2QQ==; JSESSIONID=ADBC8C3DADF6C815D778450C193C6637.ajp13_worker; Hm_lvt_ce55bfda158556585a8b7b246346c8ba=1498560244,1498739070,1498833193,1498917432; Hm_lpvt_ce55bfda158556585a8b7b246346c8ba=1498917597; CNZZDATA1262047894=1598545996-1495973145-%7C1498917578
   		/* 空行 */
  username=hfcai&sex=man /* 请求数据 */
  ```

  

* 响应报文

  响应报文包括：状态行、响应报头、空行和响应正文

  常见状态码：一般 1XX 代表服务器接收到请求、2XX 代表成功、3XX 代表重定向、4XX 代
  表客户端错误、5XX 代表服务器端错误。

  * 200：请求成功
  * 202：服务器端已经收到请求消息，但是尚未进行处理
  * 301：永久重定向
  * 302：临时重定向
  * 304：所请求的资源未被修改（被协商缓存了）
  * 400：客户端请求的语法错误
  * 404：请求资源不存在
  * 500：服务器内部错误

  ```js
  HTTP/1.0 200 OK		/* 状态行：协议版本字段|空格|状态码|空格|状态信息 */
  Content-Type: text/plain /* 空行前为响应消息的报头 */
  Content-Length: 137582
  Expires: Thu, 05 Dec 1997 16:00:00 GMT
  Last-Modified: Wed, 5 August 1996 15:55:28 GMT
  Server: Apache 0.84
  		/* 空行 */
  <html>	/* 空行以下为响应正文。包含了所请求的对象 */
  <body>Hello World</body>
  </html>
  ```



### 2. HTTP/2 协议

主要是解决HTTP/1.1效率不高的问题。HTTP/2主要有以下新的特性：

#### （1）二进制协议

在HTTP/1.1中。报文的头信息必须是文本（ASCII编码）。数据体可以实文本，也可以时二进制。

HTTP/2 是一个彻底的二进制协议。头信息和数据体都是二进制，并且统称为“帧”，可以分为头信息帧和数据帧。帧的概念的它实现多路复用的基础。

#### （2）多路复用

HTTP/2仍然复用TCP链接，但是在一个链接里，客户端和服务器都可以同时发送多个请求或响应，不用按顺序一一发送。避免“队头堵塞”的问题。

#### （3）数据流

它将每个请求或响应发送的所有数据包，称为一个数据流。HTTP/2的数据包时不按顺序发送的，同一个链接里面连续的数据包，可能属于不同请求。所以，需要对数据包做标记，指出它属于哪个请求。。每个数据流有独一无二的编号。

#### （4）头信息压缩

HTTP/2实现了头信息压缩。由于HTTP/1.1不带有状态，所以每次请求都必须附上所有消息。

HTTP/2引入了头信息压缩机制。一方面，头信息使用gzip或compress压缩后在发送；另一方面，客户端和服务器同时维护一张头信息表，所有字段都会存入这个表，生成一个索引号，以后就发送同样的字段了。只发送索引号，提高速度。

#### （5）服务器推送

HTTP/2允许服务器未经请求，主动向客户端发送资源，这叫做服务器推送。

可以提前给客户端推送必要的资源，这样就可以相对减少一些延迟时间。

> HTTP/2主动推送的是静态资源，和Websocket以及使用SSE等方式向客户端发送即时数据的推送不同。

#### （6）HTTP/2的缺点

因为有多路复用，一般来说同一个域名下只需要使用一个TCP链接。由于多个数据流使用同一个TCP链接，遵守同一个流量状态控制和拥塞控制。只要一个数据流遭遇拥塞，剩下的数据流就没法发出去，这就导致后面的所有数据都会被阻塞。这是TCP协议的问题，和它本身的实现没有多大关系。

#### （7）HTTP/3

由于TCP本身存在的限制，Google开发了一个基于UDP协议的QUIC协议，并且使用在HTTP/3上。QUIC协议在UDP上实现了多路复用，有序交付，重传等等功能



### 3. HTTPS

